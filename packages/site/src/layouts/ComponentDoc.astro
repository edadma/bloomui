---
import Layout from './Layout.astro';

export interface Prop {
  name: string;
  type: string;
  default?: string;
  description: string;
  required?: boolean;
}

interface Props {
  name: string;
  description: string;
  category: string;
  props: Prop[];
  subComponents?: Array<{
    name: string;
    description: string;
    props: Prop[];
  }>;
  methods?: Array<{
    name: string;
    signature: string;
    description: string;
  }>;
}

const { name, description, category, props, subComponents, methods } = Astro.props;
const docsBase = 'https://edadma.github.io/bloomui';
const slug = name.toLowerCase().replace(/\./g, '');
---

<Layout title={`${name} - BloomUI`} description={description}>
  <article itemscope itemtype="https://schema.org/TechArticle">
    <header class="mb-8">
      <nav class="text-sm breadcrumbs mb-4">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/components">Components</a></li>
          <li><a href={`/components#category-${category.toLowerCase().replace(/\s+/g, '-')}`}>{category}</a></li>
          <li>{name}</li>
        </ul>
      </nav>

      <h1 class="text-4xl font-bold" itemprop="name">{name}</h1>
      <p class="text-lg text-base-content/70 mt-2" itemprop="description">{description}</p>

      <div class="flex gap-4 mt-4">
        <a href={`${docsBase}/${slug}`} class="btn btn-primary btn-sm" target="_blank" rel="noopener">
          Interactive Demo
        </a>
        <a href={`https://github.com/edadma/bloomui/blob/main/packages/bloomui/src/components/${name.split('.')[0]}.tsx`} class="btn btn-outline btn-sm" target="_blank" rel="noopener">
          Source
        </a>
      </div>
    </header>

    <!-- Import -->
    <section class="mb-8">
      <h2 class="text-2xl font-bold mb-4">Import</h2>
      <div class="bg-base-200 rounded-lg p-4">
        <pre><code>{`import { ${name.split('.')[0]} } from '@edadma/bloomui';`}</code></pre>
      </div>
    </section>

    <!-- Custom content slot (examples, usage, etc.) -->
    <slot />

    <!-- Props Table -->
    <section class="mb-8">
      <h2 class="text-2xl font-bold mb-4">Props</h2>
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
          <thead>
            <tr>
              <th>Property</th>
              <th>Type</th>
              <th>Default</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            {props.map(prop => (
              <tr>
                <td>
                  <code class="text-primary">{prop.name}</code>
                  {prop.required && <span class="text-error ml-1">*</span>}
                </td>
                <td><code class="text-xs bg-base-200 px-1 rounded">{prop.type}</code></td>
                <td>{prop.default ? <code class="text-xs">{prop.default}</code> : <span class="text-base-content/50">-</span>}</td>
                <td>{prop.description}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </section>

    <!-- Sub-components -->
    {subComponents && subComponents.length > 0 && (
      <section class="mb-8">
        <h2 class="text-2xl font-bold mb-4">Sub-components</h2>
        {subComponents.map(sub => (
          <div class="mb-6">
            <h3 class="text-xl font-semibold mb-2">{sub.name}</h3>
            <p class="text-base-content/70 mb-4">{sub.description}</p>
            <div class="overflow-x-auto">
              <table class="table table-zebra w-full">
                <thead>
                  <tr>
                    <th>Property</th>
                    <th>Type</th>
                    <th>Default</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  {sub.props.map(prop => (
                    <tr>
                      <td>
                        <code class="text-primary">{prop.name}</code>
                        {prop.required && <span class="text-error ml-1">*</span>}
                      </td>
                      <td><code class="text-xs bg-base-200 px-1 rounded">{prop.type}</code></td>
                      <td>{prop.default ? <code class="text-xs">{prop.default}</code> : <span class="text-base-content/50">-</span>}</td>
                      <td>{prop.description}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        ))}
      </section>
    )}

    <!-- Static Methods -->
    {methods && methods.length > 0 && (
      <section class="mb-8">
        <h2 class="text-2xl font-bold mb-4">Methods</h2>
        <div class="space-y-4">
          {methods.map(method => (
            <div class="bg-base-200 rounded-lg p-4">
              <h3 class="font-mono font-semibold text-primary">{method.name}</h3>
              <code class="text-sm block mt-2 bg-base-300 p-2 rounded">{method.signature}</code>
              <p class="mt-2 text-base-content/70">{method.description}</p>
            </div>
          ))}
        </div>
      </section>
    )}

    <!-- Testing -->
    <section class="mb-8">
      <h2 class="text-2xl font-bold mb-4">Testing</h2>
      <p class="mb-4">This component supports the following test attributes:</p>
      <ul class="list-disc list-inside space-y-1 mb-4">
        <li><code>data-testid</code> - Component identifier for test selection</li>
        <li><code>data-state</code> - Current component state (where applicable)</li>
        <li>Standard HTML attributes via prop spreading (<code>...rest</code>)</li>
      </ul>
      <div class="bg-base-200 rounded-lg p-4">
        <pre><code>{`// Example test
import { render, screen } from '@testing-library/react';
import { ${name.split('.')[0]} } from '@edadma/bloomui';

screen.getByRole('...');  // Use appropriate ARIA role
screen.getByTestId('...');  // Use data-testid`}</code></pre>
      </div>
    </section>
  </article>
</Layout>
